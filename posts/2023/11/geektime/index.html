<!doctype html><html lang=zh dir=ltr><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>极客时间文章整理 | Dylan Yin</title>
<meta name=generator content="Hugo Eureka 0.9.3"><link rel=stylesheet href=/css/eureka.min.9cec6350e37e534b0338fa9a085bf06855de3b0f2dcf857e792e5e97b07ea905d4d5513db554cbc26a9c3da622bae92d.css><script defer src=/js/eureka.min.fa9a6bf6d7a50bb635b4cca7d2ba5cf3dfb095ae3798773f1328f7950028b48c17d06276594e1b5f244a25a6c969a705.js></script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&amp;family=Noto+Serif+SC:wght@400;600;700&amp;display=swap" as=style onload='this.onload=null,this.rel="stylesheet"'><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/styles/solarized-light.min.css media=print onload='this.media="all",this.onload=null' crossorigin><script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/highlight.min.js crossorigin></script><script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/dart.min.js crossorigin></script><script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/python.min.js crossorigin></script><script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/rust.min.js crossorigin></script><script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/json.min.js crossorigin></script><link rel=stylesheet href=/css/highlightjs.min.2958991528e43eb6fc9b8c4f2b8e052f79c4010718e1d1e888a777620e9ee63021c2c57ec7417a3108019bb8c41943e6.css media=print onload='this.media="all",this.onload=null'><script defer type=text/javascript src=/js/fontawesome.min.fb4f99bf68b5bbbdcf848d3ca8ede1fe65f94ab98a9199e81a85df1403fd185cd7e687196e7d75378fec2f96450a74b3.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ media=print onload='this.media="all",this.onload=null' crossorigin><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script><script defer src=https://cdn.jsdelivr.net/npm/mermaid@8.14.0/dist/mermaid.min.js integrity=sha384-atOyb0FxAgN9LyAc6PEf9BjgwLISyansgdH8/VXQH8p2o5vfrRgmGIJ2Sg22L0A0 crossorigin></script><link rel=icon type=image/png sizes=32x32 href=/icon_hu6d227acdcf07eb27d390c3dd4040e775_275865_32x32_fill_box_center_3.png><link rel=apple-touch-icon sizes=180x180 href=/icon_hu6d227acdcf07eb27d390c3dd4040e775_275865_180x180_fill_box_center_3.png><meta name=description content="之前收集了很多极客时间的教程，但是不想每次都用浏览器去阅读，正巧我有两台墨水屏设备。于是想把极客的网页整理为书籍 epub 格式，然后阅读做笔记。大致流程为 html->markdown->epub, 之"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"/posts/"},{"@type":"ListItem","position":2,"name":"极客时间文章整理","item":"/posts/2023/11/geektime/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/2023/11/geektime/"},"headline":"极客时间文章整理 | Dylan Yin","datePublished":"2023-11-07T05:37:00+08:00","dateModified":"2023-11-23T01:50:02+08:00","wordCount":724,"publisher":{"@type":"Person","name":"C. Wang","logo":{"@type":"ImageObject","url":"/icon.png"}},"description":"之前收集了很多极客时间的教程，但是不想每次都用浏览器去阅读，正巧我有两台墨水屏设备。于是想把极客的网页整理为书籍 epub 格式，然后阅读做笔记。大致流程为 html-\u0026gt;markdown-\u0026gt;epub, 之"}</script><meta property="og:title" content="极客时间文章整理 | Dylan Yin"><meta property="og:type" content="article"><meta property="og:image" content="/icon.png"><meta property="og:url" content="/posts/2023/11/geektime/"><meta property="og:description" content="之前收集了很多极客时间的教程，但是不想每次都用浏览器去阅读，正巧我有两台墨水屏设备。于是想把极客的网页整理为书籍 epub 格式，然后阅读做笔记。大致流程为 html->markdown->epub, 之"><meta property="og:locale" content="zh"><meta property="og:site_name" content="Dylan Yin"><meta property="article:published_time" content="2023-11-07T05:37:00+08:00"><meta property="article:modified_time" content="2023-11-23T01:50:02+08:00"><meta property="article:section" content="posts"><body class="flex min-h-screen flex-col"><header class="min-h-16 pl-scrollbar bg-secondary-bg fixed z-50 flex w-full items-center shadow-sm"><div class="mx-auto w-full max-w-screen-xl"><script>let storageColorScheme=localStorage.getItem("lightDarkMode");((storageColorScheme=="Auto"||storageColorScheme==null)&&window.matchMedia("(prefers-color-scheme: dark)").matches||storageColorScheme=="Dark")&&document.getElementsByTagName("html")[0].classList.add("dark")</script><nav class="flex items-center justify-between flex-wrap px-4 py-4 md:py-0"><a href=/ class="me-6 text-primary-text text-xl font-bold">Dylan Yin</a>
<button id=navbar-btn class="md:hidden flex items-center px-3 py-2" aria-label="Open Navbar">
<i class="fas fa-bars"></i></button><div id=target class="hidden block md:flex md:grow md:justify-between md:items-center w-full md:w-auto text-primary-text z-20"><div class="md:flex md:h-16 text-sm md:grow pb-4 md:pb-0 border-b md:border-b-0"><a href=/#about class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">About</a>
<a href=/posts/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 selected-menu-item me-4">Posts</a>
<a href=/docs/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">Docs</a></div><div class=flex><div class="relative pt-4 md:pt-0"><div class="cursor-pointer hover:text-eureka" id=lightDarkMode><i class="fas fa-adjust"></i></div><div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-30" id=is-open></div><div class="absolute flex flex-col start-0 md:start-auto end-auto md:end-0 hidden bg-secondary-bg w-48 rounded py-2 border border-tertiary-bg cursor-pointer z-40" id=lightDarkOptions><span class="px-4 py-1 hover:text-eureka" name=Light>浅色</span>
<span class="px-4 py-1 hover:text-eureka" name=Dark>深色</span>
<span class="px-4 py-1 hover:text-eureka" name=Auto>自动</span></div></div></div></div><div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-0" id=is-open-mobile></div></nav><script>let element=document.getElementById("lightDarkMode");storageColorScheme==null||storageColorScheme=="Auto"?document.addEventListener("DOMContentLoaded",()=>{window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",switchDarkMode)}):storageColorScheme=="Light"?(element.firstElementChild.classList.remove("fa-adjust"),element.firstElementChild.setAttribute("data-icon","sun"),element.firstElementChild.classList.add("fa-sun")):storageColorScheme=="Dark"&&(element.firstElementChild.classList.remove("fa-adjust"),element.firstElementChild.setAttribute("data-icon","moon"),element.firstElementChild.classList.add("fa-moon")),document.addEventListener("DOMContentLoaded",()=>{getcolorscheme(),switchBurger()})</script></div></header><main class="grow pt-16"><div class=pl-scrollbar><div class="mx-auto w-full max-w-screen-xl lg:px-4 xl:px-8"><div class="grid grid-cols-2 gap-4 lg:grid-cols-8 lg:pt-12"><div class="lg:col-start-2 bg-secondary-bg col-span-2 rounded px-6 py-8 lg:col-span-6"><article class=prose><h1 class=mb-4>极客时间文章整理</h1><div class="text-tertiary-text not-prose mt-2 flex flex-row flex-wrap items-center"><div class="me-6 my-2"><i class="fas fa-calendar me-1"></i>
<span>2023-11-07</span></div><div class="me-6 my-2"><i class="fas fa-clock me-1"></i>
<span>2分钟阅读时长</span></div></div><p>之前收集了很多极客时间的教程，但是不想每次都用浏览器去阅读，正巧我有两台墨水屏设备。于是想把极客的网页整理为书籍 epub 格式，然后阅读做笔记。大致流程为 html->markdown->epub, 之所以不直接用 pandoc 解析为 epub 有几点考虑，一是直接转换效果非常的差，二是我想做一些数据的清理，三是我想要一整个课程合成为一个书籍。尝试下来，我发现 python 中的一个库 html2text 效果符合预期，于是在 ChatGPT 的辅助下，编写了一段脚本，生成一个大的 Markdown 文件，之后用 pandoc 处理后得到 epub 非常符合预期。</p><pre><code class=language-python>import sys
import subprocess
import os
import html2text
import re


def remove_empty_lines_in_indented_code_blocks(content):
    lines = content.split(&quot;\n&quot;)
    in_code_block = False
    code_block = []
    res = &quot;&quot;

    for line in lines:
        if line.startswith(
            &quot;    &quot;
        ):  # Check for code block indentation (adjust the number of spaces as needed)
            in_code_block = True
            code_block.append(line)
        else:
            if in_code_block:
                # Remove empty lines in the code block
                code_block = [line for line in code_block if line.strip() != &quot;&quot;]
                res += &quot;\n&quot;.join(code_block)
                res += &quot;\n\n&quot;
                in_code_block = False
                code_block = []
            if line == &quot;&quot;:
                res += &quot;\n\n&quot;
            else:
                res += line
    return res


# 定义一个排序键函数，提取字符串中的数字并转换为整数进行比较
def custom_sort_key(item):
    # 使用正则表达式提取字符串中的数字部分
    last_slash_index = item.rfind(&quot;/&quot;)
    title = item[last_slash_index + 1 :]
    match = re.search(r&quot;\d+&quot;, title)
    if match:
        # 将提取的数字部分转换为整数
        return int(match.group())
    else:
        # 如果字符串中没有数字，则返回一个负无穷大的数，确保没有数字的项在最前面
        return float(&quot;+inf&quot;)


if __name__ == &quot;__main__&quot;:
    if len(sys.argv) &lt; 2:
        print(&quot;Usage: python gen_book.py directory_path&quot;)
    else:
        directory_path = sys.argv[1]
        last_slash_index = directory_path.rfind(&quot;/&quot;)
        book_name = directory_path[last_slash_index + 1 :]
        file_paths = []
        # 使用os.walk遍历目录及其子目录下的文件
        for root, dirs, files in os.walk(directory_path):
            for file in files:
                if file.endswith(&quot;.html&quot;):  # 只处理后缀为&quot;.html&quot;的文件
                    file_path = os.path.join(root, file)
                    file_paths.append(file_path)

        file_paths.sort()
        file_paths = sorted(file_paths, key=custom_sort_key, reverse=False)
        pattern = r&quot;(.*?)©\ 加微信&quot;
        pattern2 = r&quot;(.*?)©\ 版权归极客邦科技所有&quot;
        # 使用 Pandoc 将 Markdown 转换为 PDF
        with open(&quot;./result.md&quot;, &quot;a&quot;) as result_file:
            for file_path in file_paths:
                text = file_path
                last_slash_index = text.rfind(&quot;/&quot;)
                title = text[last_slash_index + 1 :]
                title = title.replace(&quot;.html&quot;, &quot;&quot;)
                with open(file_path, &quot;r&quot;) as file:
                    file_content = html2text.html2text(file.read())
                    match = re.search(pattern, file_content, re.DOTALL)
                    match2 = re.search(pattern2, file_content, re.DOTALL)
                    if match or match2:
                        if match:
                            matched_content = match.group(1)
                        if match2:
                            matched_content = match2.group(1)
                        matched_content = matched_content.replace(&quot;    | \n    \n&quot;, &quot;&quot;)
                        matched_content = matched_content.replace(
                            &quot;    ---|---  \n      \n&quot;, &quot;&quot;
                        )
                        matched_content = matched_content.replace(&quot;    复制代码\n\n&quot;, &quot;&quot;)
                        last_image_pattern = (
                            r&quot;!\[([^\]]*)\]\([^)]+\)(?![\s\S]*!\[[^\]]*\]\([^)]+\))&quot;
                        )
                        matched_content = re.sub(
                            last_image_pattern, &quot;&quot;, matched_content
                        )
                        matched_content = remove_empty_lines_in_indented_code_blocks(
                            matched_content
                        )
                        result_file.write(&quot;# &quot; + str(title) + &quot;\n&quot;)
                        result_file.write(matched_content)
        subprocess.call(
            [
                &quot;pandoc&quot;,
                &quot;result.md&quot;,
                &quot;-o&quot;,
                book_name + &quot;.epub&quot;,
                &quot;--metadata&quot;,
                &quot;title=&quot; + book_name,
            ]
        )
    if os.path.exists(&quot;result.md&quot;):
        os.remove(&quot;result.md&quot;)
</code></pre></article><div class="-mx-2 mt-4 flex flex-col border-t px-2 pt-4 md:flex-row md:justify-between"><div><span class="text-primary-text block font-bold">上一页</span>
<a href=/posts/2023/11/nixos_begin/ class=block>NixOS 初尝试</a></div><div class="mt-4 md:mt-0 md:text-right"><span class="text-primary-text block font-bold">下一页</span>
<a href=/posts/2023/09/midnight/ class=block>深夜随想</a></div></div></div></div><script>document.addEventListener("DOMContentLoaded",()=>{hljs.highlightAll()})</script></div></div></main><footer class=pl-scrollbar><div class="mx-auto w-full max-w-screen-xl"><div class="text-center p-6 pin-b"><p class="text-sm text-tertiary-text">&copy; Mr. Dylan Yin
&#183; Powered by the <a href=https://github.com/wangchucheng/hugo-eureka class=hover:text-eureka>Eureka</a> theme for <a href=https://gohugo.io class=hover:text-eureka>Hugo</a></p></div></div></footer></body></html>